<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="å‰ç«¯"><title>Puppeteeræˆªå–ç›´æ’­ç”»é¢ | cheerylong'blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Puppeteeræˆªå–ç›´æ’­ç”»é¢</h1><a id="logo" href="/blog/.">cheerylong'blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/blog/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/blog/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Puppeteeræˆªå–ç›´æ’­ç”»é¢</h1><div class="post-meta">Nov 20, 2018<span> | </span><span class="category"><a href="/blog/categories/å·¥å…·/">å·¥å…·</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><a class="disqus-comment-count" href="/blog/2018/11/20/puppeteeræˆªå–ç›´æ’­é—´ç”»é¢/#vcomment"><span class="valine-comment-count" data-xid="/blog/2018/11/20/puppeteeræˆªå–ç›´æ’­é—´ç”»é¢/"></span><span> æ¡è¯„è®º</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Puppeteerä»‹ç»"><span class="toc-number">1.</span> <span class="toc-text">Puppeteerä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å…³é”®APIä»‹ç»"><span class="toc-number">2.</span> <span class="toc-text">å…³é”®APIä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®æˆ˜-æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢"><span class="toc-number">3.</span> <span class="toc-text">å®æˆ˜: æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#éœ€æ±‚åˆ†æ"><span class="toc-number">3.1.</span> <span class="toc-text">éœ€æ±‚åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®ç°é€»è¾‘"><span class="toc-number">3.2.</span> <span class="toc-text">å®ç°é€»è¾‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">4.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div><div class="post-content"><p>å‰å‡ å¤©æœ‰ä¸ªåŒå­¦é—®èµ·å¦‚ä½•å®ç°æˆªå–ç›´æ’­é—´çš„å›¾ç‰‡ï¼Œåˆ†æç›´æ’­å†…å®¹ï¼Œå½“æ—¶å°±æƒ³åˆ°äº†ç”¨æ— å¤´æµè§ˆå™¨å®ç°ã€‚æ­£å¥½ä¹‹å‰äº†è§£è¿‡ <code>Puppeteer</code> æ¨èä»–ä½¿ç”¨äº†è¯¥å·¥å…·ï¼Œåæ¥ä»–ç”¨ç±»ä¼¼çš„ <code>Pyppeteer</code> å®ç°äº†è¯¥éœ€æ±‚ï¼Œå‡ºäºå¥½å¥‡æˆ‘ä½¿ç”¨ <code>Puppeteer</code> å®ç°äº†ä¸€ç‰ˆï¼Œä¹Ÿé¡ºä¾¿è¿‡äº†ä¸€é <a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/" target="_blank" rel="noopener">puppeteer</a> æ–‡æ¡£ï¼Œä»”ç»†äº†è§£äº†ä¸€ä¸‹å„ä¸ªåŠŸèƒ½ï¼Œä½œæ­¤æ–‡æ€»ç»“ã€‚</p>
<h2 id="Puppeteerä»‹ç»"><a href="#Puppeteerä»‹ç»" class="headerlink" title="Puppeteerä»‹ç»"></a>Puppeteerä»‹ç»</h2><p><code>Puppeteer</code> æ˜¯ä¸€ä¸ª <code>Node</code> åº“ï¼Œå®ƒæä¾› <code>API</code> æ¥é€šè¿‡ <code>DevTool</code> <a href="https://chromedevtools.github.io/devtools-protocol/" target="_blank" rel="noopener">åè®®</a>  æ§åˆ¶ <code>Chromium/Chrome</code> æ‰€ä»¥ä¸€èˆ¬ä¹Ÿç§°å®ƒä¸º <code>æ— å¤´æµè§ˆå™¨</code>ï¼Œå®ƒæœ‰å‡ ä¸ªå…³é”®æ¦‚å¿µ:</p>
<ul>
<li><p>Browser </p>
<p>  æƒ³æƒ³æˆ‘ä»¬æ“ä½œæµè§ˆå™¨æ—¶ï¼Œä¸€èˆ¬ä¼šé¦–å…ˆæ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œ<code>Browser</code> å°±ä»£è¡¨ <code>Puppteer</code> é€šè¿‡ <code>DeveTool</code> åè®® æ“ä½œçš„æµè§ˆå™¨ï¼Œå®ƒæ‹¥æœ‰æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€å®ƒï¼Œå…³é—­å®ƒï¼Œç­‰å„ç§æ“ä½œï¼Œä¸€èˆ¬è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä½¿ç”¨ <code>Puppteer</code>çš„ç¬¬ä¸€æ­¥ã€‚</p>
</li>
<li><p>Page</p>
<p>  <code>Page</code> ä»£è¡¨ä¸€ä¸ªé¡µé¢æ¡†æ¶ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå‰ç«¯æ¦‚å¿µçš„é¡µé¢ï¼Œå®ƒå…¶ä¸­æœ‰ä¸€ä¸ªä¸»æ¡†æ¶ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬å¾ˆå¤šå…¶å®ƒçš„æ¡†æ¶ï¼Œç±»ä¼¼äº <code>iframe</code> æ¦‚å¿µï¼Œæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨è¦æ“ä½œå…·ä½“çš„ä¸€ä¸ªé¡µé¢ï¼Œå°±å¿…é¡»ä½¿ç”¨åˆ° <code>Page</code> å¯ä»¥å¯¹å®ƒæ¨¡æ‹Ÿå„ç§è¡Œä¸ºï¼Œä¾‹å¦‚ç‚¹å‡»ï¼Œé€‰ä¸­ï¼Œç”šè‡³åœ¨å…¶ä¸­æ‰§è¡Œ <code>JavaScript</code> æ’å…¥cssç­‰æ“ä½œã€‚å½“ç„¶å®ƒæ˜¯ä¾èµ– <code>Browser</code> çš„ã€‚</p>
</li>
<li><p>Frame</p>
<p>  é¡µé¢æ¡†æ¶ï¼Œç†Ÿæ‚‰ <code>HTML</code> çš„æœ‹å‹ä¸€å®šäº†è§£ï¼Œä¸€ä¸ªhtmlæ–‡æ¡£æ˜¯å¯ä»¥åŒ…å«å¤šä¸ª frameçš„ï¼Œé‡Œé¢éƒ½ä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆä¸Šä¸‹æ–‡, é€šè¿‡ <code>Frame</code> , <code>Puppteer</code>å¯ä»¥æ“ä½œé¡µé¢ä¸­çš„æ¡†æ¶</p>
</li>
</ul>
<h2 id="å…³é”®APIä»‹ç»"><a href="#å…³é”®APIä»‹ç»" class="headerlink" title="å…³é”®APIä»‹ç»"></a>å…³é”®APIä»‹ç»</h2><p>ä¸‹é¢ä»‹ç»å‡ ä¸ªå…³é”® <code>api</code> å®ç°å„ç§ç‰¹å®šåŠŸèƒ½æ—¶ï¼Œæ ¹æ®ğŸ‘†çš„æ¨¡å—ï¼Œå»å¯¹åº”çš„æ–‡æ¡£æ‰¾æä¾›çš„ <code>api</code> å³å¯ã€‚</p>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Puppeteer?id=puppeteerlaunchoptions" target="_blank" rel="noopener">Puppteer.launch</a></p>
<p>é€šè¿‡è¯¥ <code>api</code> å¯ä»¥åŠ è½½ä¸€ä¸ªæµè§ˆå™¨ç¤ºä¾‹ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨è‡ªå·±æœ¬åœ°çš„æµè§ˆå™¨</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch(&#123;</span><br><span class="line">    headless: <span class="literal">true</span>,</span><br><span class="line">    executablePath: <span class="string">'/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'</span>,</span><br><span class="line">    slowMo: <span class="number">100</span>,</span><br><span class="line">    args: []</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Browser?id=browsernewpage" target="_blank" rel="noopener">browser.newPage</a></p>
<p>æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨åï¼Œå¯ä»¥ä½¿ç”¨è¯¥ api æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå¦‚æœæœ‰éœ€è¦æ‰“å¼€å¤šä¸ªé¡µé¢çš„éœ€æ±‚ï¼Œæœ€å¥½åœ¨ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹ä¸­æ‰“å¼€ï¼ŒèŠ‚çœå†…å­˜ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥çª—å£äº†åŠæ—¶ä½¿ç”¨<code>browser.close()</code> å…³é—­æµè§ˆå™¨çª—å£ã€‚</p>
</li>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageviewport" target="_blank" rel="noopener">page.viewport</a></p>
<p>  å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•æŒ‡å®šçª—å£çš„å¤§å°ï¼ŒæŸ¥çœ‹é¡µé¢åŠ è½½æƒ…å†µã€‚</p>
</li>
</ul>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pagewaitforselectororfunctionortimeout-options-args" target="_blank" rel="noopener">page.waitFor</a></p>
<p>  ç­‰å¾…ä¸€å®šæ—¶é—´æ‰§è¡Œæ“ä½œï¼Œæœ‰å¾ˆå¤šè€—æ—¶çš„æ“ä½œï¼Œä¾‹å¦‚è§†é¢‘åŠ è½½ç­‰ç­‰ï¼Œå¸¸å¸¸éœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„çš„æ—¶ï¼Œ<code>page</code> è™½ç„¶ä¹Ÿå¯ä»¥ç›‘å¬ä¸€äº›ç±»ä¼¼ <code>load</code> è¿™æ ·çš„äº‹ä»¶ï¼Œä½†æ˜¯æœ‰äº›æ— æ³•ç›‘å¬åˆ°çš„è€—æ—¶æƒ…å†µï¼Œè¿˜æ˜¯åªèƒ½ä½¿ç”¨ <code>waitFor</code> å®ç°</p>
</li>
</ul>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pagegotourl-options" target="_blank" rel="noopener">page.goto</a></p>
<p>  å¯¼èˆªåˆ°ä¸€ä¸ªåœ°å€</p>
</li>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageselector" target="_blank" rel="noopener">page.$</a></p>
<p>  åŒ <code>document.querySelector()</code></p>
</li>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageselector-1" target="_blank" rel="noopener">page.$$</a></p>
<p>  åŒ <code>document.querySelectorAll()</code></p>
</li>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageevalselector-pagefunction-args-1" target="_blank" rel="noopener">page.$eval</a></p>
<p>  <code>document.querySelector</code> é€‰æ‹© <code>dom</code> èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æµè§ˆå™¨ä¸Šä¸‹æ–‡æ‰§è¡Œ(å› ä¸ºæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œï¼Œåœ¨æ­¤å¤„æ‰“æ—¥å¿—ï¼Œå¹¶ä¸ä¼šä½“ç°åœ¨æ§åˆ¶å°),è¿”å›æ‰§è¡Œç»“æœ</p>
</li>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageevalselector-pagefunction-args" target="_blank" rel="noopener">page.$$eval</a></p>
<p>  <code>document.querySelectorAll</code> é€‰æ‹© <code>dom</code> èŠ‚ç‚¹listï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨æµè§ˆå™¨ä¸Šä¸‹æ–‡æ‰§è¡Œ(å› ä¸ºæ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œï¼Œåœ¨æ­¤å¤„æ‰“æ—¥å¿—ï¼Œå¹¶ä¸ä¼šä½“ç°åœ¨æ§åˆ¶å°),è¿”å›æ‰§è¡Œç»“æœ</p>
</li>
</ul>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pagescreenshotoptions" target="_blank" rel="noopener">page.screenshot</a></p>
<p>  æ‰§è¡Œæˆªå›¾æ“ä½œï¼Œè¯¥æ–¹æ³•å¯ä»¥é…ç½®æˆªå–ä½ç½®ç­‰å±æ€§ï¼Œå¯ä»¥çµæ´»é€‰æ‹©</p>
</li>
</ul>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pageclickselector-options" target="_blank" rel="noopener">page.click</a></p>
<p>  è§¦å‘å…ƒç´ çš„ <code>click</code> äº‹ä»¶</p>
</li>
</ul>
<ul>
<li><p><a href="https://zhaoqize.github.io/puppeteer-api-zh_CN/#/class-Page?id=pagecloseoptions" target="_blank" rel="noopener">page.close</a></p>
<p>  å…³é—­çª—å£ï¼Œå¦‚æœé¡µé¢ä¸ä½¿ç”¨äº†ï¼Œä¸€å®šè¦åŠæ—¶å…³é—­</p>
</li>
</ul>
<h2 id="å®æˆ˜-æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢"><a href="#å®æˆ˜-æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢" class="headerlink" title="å®æˆ˜: æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢"></a>å®æˆ˜: æˆªå–ç›´æ’­å¹³å°ç›´æ’­ç”»é¢</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>  æ‰“å¼€æŸä¸€ä¸ªç›´æ’­å¹³å°ï¼Œæ‹¿åˆ°æ‰€æœ‰çš„ç›´æ’­é—´åœ°å€ï¼Œåˆ†åˆ«è®¿é—®è¯¥ç›´æ’­é—´ï¼Œå¾ªç¯æˆªå–è¯¥ç›´æ’­é—´ç”»é¢ï¼Œä¿å­˜å›¾ç‰‡åˆ°æŸä¸€ä¸ªåœ°å€ã€‚</p>
<h3 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h3><ol>
<li><p>é€šè¿‡ <code>Puppteer</code> å®ä¾‹åŒ–ä¸€ä¸ª <code>browser</code>,æ‰“å¼€ç›´æ’­å¹³å°é¦–é¡µï¼Œæ‹¿åˆ°æ‰€æœ‰ç›´æ’­é“¾æ¥ï¼Œæˆ¿é—´å·ã€‚</p>
</li>
<li><p>é€šè¿‡ <code>browser</code> å’Œåˆšåˆšæ‹¿åˆ°çš„ç›´æ’­é“¾æ¥å¾ªç¯æ‰“å¼€å¤šä¸ª <code>Page</code> åŠ è½½ç›´æ’­é—´ã€‚</p>
</li>
<li><p>ç­‰å¾…ç›´æ’­é—´åŠ è½½å®Œæˆï¼Œéš”ä¸€å®šæ—¶é—´å¾ªç¯æˆªå›¾å³å¯ã€‚</p>
</li>
<li><p>ä¿å­˜å›¾ç‰‡è‡³æŒ‡å®šæ–‡ä»¶å¤¹</p>
<p>çœ‹é€»è¾‘åˆ†æè¿˜æ˜¯è›®ç®€å•çš„ï¼Œä¸‹é¢æ˜¯å®ç°ä»£ç </p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¸é‡å®šä¹‰</span></span><br><span class="line"><span class="keyword">const</span> host = <span class="string">'https://look.163.com'</span>; <span class="comment">// ç›´æ’­å¹³å°åŸŸå</span></span><br><span class="line"><span class="keyword">const</span> homeHost = <span class="string">`<span class="subst">$&#123;host&#125;</span>/hot`</span>; <span class="comment">// ç›´æ’­é—´é¦–é¡µåœ°å€</span></span><br><span class="line"><span class="keyword">const</span> isLoop = <span class="literal">true</span>; <span class="comment">// æ˜¯å¦éœ€è¦å¾ªç¯æˆªå–åŒä¸€ç›´æ’­é—´çš„å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">const</span> loopTime = <span class="number">10000</span>; <span class="comment">// å¾ªç¯é—´éš”</span></span><br><span class="line"><span class="keyword">const</span> openedNum = <span class="number">7</span>; <span class="comment">// ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹åªèƒ½æ‰“å¼€çš„ç›´æ’­é—´ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">const</span> endCondition = <span class="literal">false</span>; <span class="comment">// ä»€ä¹ˆæƒ…å†µä¸‹ç»“æŸç¨‹åº? </span></span><br><span class="line"><span class="keyword">const</span> loadingTime = <span class="number">10000</span>; <span class="comment">// ç­‰ç›´æ’­åŠ è½½å‡ºæ¥ è§†ç½‘ç»œæƒ…å†µè°ƒæ•´</span></span><br><span class="line"><span class="keyword">const</span> playBtnShowTime = <span class="number">5000</span>; <span class="comment">// ç­‰æ’­æ”¾æŒ‰é’®åŠ è½½å‡ºæ¥</span></span><br><span class="line"><span class="keyword">const</span> launchConfig = &#123;</span><br><span class="line">    headless: <span class="literal">true</span>,</span><br><span class="line">    executablePath: <span class="string">'/Applications/Google Chrome.app/Contents/MacOS/Google Chrome'</span>,</span><br><span class="line">    slowMo: <span class="number">100</span>,</span><br><span class="line">    args: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆæ–‡ä»¶ç›®å½•</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createDir</span>(<span class="params">dirName = <span class="string">''</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!fs.existsSync(<span class="string">`screenShot/<span class="subst">$&#123;dirName&#125;</span>`</span>)) &#123;</span><br><span class="line">        fs.mkdirSync(<span class="string">`screenShot/<span class="subst">$&#123;dirName&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»é“¾æ¥è·å–æˆ¿é—´å·</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRoomId</span>(<span class="params">roomLink = <span class="string">''</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!roomLink) <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> roomLink.split(<span class="string">'?'</span>)[<span class="number">1</span>].split(<span class="string">'&amp;'</span>)[<span class="number">0</span>].split(<span class="string">'='</span>)[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†ç›´æ’­é—´æˆªå›¾</span></span><br><span class="line"><span class="comment"> * @Author   cheerylong</span></span><br><span class="line"><span class="comment"> * @DateTime 2018-11-20</span></span><br><span class="line"><span class="comment"> * @param    &#123;[type]&#125;   page     [description]</span></span><br><span class="line"><span class="comment"> * @param    &#123;[type]&#125;   roomLink [description]</span></span><br><span class="line"><span class="comment"> * @return   &#123;[type]&#125;            [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">handleRoomScreenShot</span>(<span class="params">page, roomLink, browser, isEnd, num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> roomId = getRoomId(roomLink);</span><br><span class="line">    createDir(roomId);</span><br><span class="line">    <span class="keyword">await</span> page.setViewport(&#123; <span class="attr">width</span>: <span class="number">1920</span>, <span class="attr">height</span>: <span class="number">1080</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> page.goto(roomLink, &#123; <span class="attr">waitUntil</span>: [<span class="string">'domcontentloaded'</span>] &#125;);</span><br><span class="line">    <span class="keyword">await</span> page.waitFor(loadingTime)</span><br><span class="line">    <span class="keyword">await</span> page.click(<span class="string">'#lvp_player_private_portal_id_private &gt; div &gt; i'</span>) <span class="comment">// ç‚¹å‡»æ’­æ”¾æŒ‰é’®</span></span><br><span class="line">    <span class="keyword">await</span> page.waitFor(playBtnShowTime)</span><br><span class="line">    <span class="keyword">let</span> videoInfo = <span class="keyword">await</span> page.$<span class="built_in">eval</span>(<span class="string">'.m-lvp-container&gt;video'</span>, (el) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            x: el.getBoundingClientRect().x,</span><br><span class="line">            y: el.getBoundingClientRect().y,</span><br><span class="line">            width: el.getBoundingClientRect().width,</span><br><span class="line">            height: el.getBoundingClientRect().height</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ä½ç½®ä¿¡æ¯: '</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(videoInfo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> page.screenshot(&#123;</span><br><span class="line">        path: <span class="string">`screenshot/<span class="subst">$&#123;roomId&#125;</span>/<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.png`</span>,</span><br><span class="line">        clip: videoInfo</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isLoop) &#123;</span><br><span class="line">        setInterval(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">await</span> page.screenshot(&#123;</span><br><span class="line">                path: <span class="string">`screenshot/<span class="subst">$&#123;roomId&#125;</span>/<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.png`</span>,</span><br><span class="line">                clip: videoInfo</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, loopTime)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.close();</span><br><span class="line">        <span class="keyword">if</span> (isEnd) &#123;</span><br><span class="line">            <span class="keyword">await</span> browser.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æˆ¿é—´é“¾æ¥åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> * @Author   cheerylong</span></span><br><span class="line"><span class="comment"> * @DateTime 2018-11-21</span></span><br><span class="line"><span class="comment"> * @return   &#123;[type]&#125;   [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getRoomList</span>(<span class="params">homePage</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> homePage.$$<span class="built_in">eval</span>(<span class="string">'.m-lc1Dft-YP9&gt;a'</span>, (rooms = []) =&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> urls = [];</span><br><span class="line">        rooms.forEach(<span class="function"><span class="params">room</span> =&gt;</span> &#123;</span><br><span class="line">            urls.push(room.href);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> urls</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="comment"> * @Author   cheerylong</span></span><br><span class="line"><span class="comment"> * @DateTime 2018-11-20</span></span><br><span class="line"><span class="comment"> * @return   &#123;[type]&#125;   [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> browser = <span class="keyword">await</span> puppeteer.launch(launchConfig);</span><br><span class="line">    <span class="keyword">const</span> homePage = <span class="keyword">await</span> browser.newPage();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–é¦–é¡µæ‰€æœ‰ç›´æ’­é—´é“¾æ¥</span></span><br><span class="line">    homePage.once(<span class="string">'domcontentloaded'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ç›´æ’­é¦–é¡µåŠ è½½å®Œæˆ'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> homePage.waitFor(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">let</span> roomList = <span class="keyword">await</span> getRoomList(homePage)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æ‰€æœ‰ç›´æ’­é—´:'</span> + roomList);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> num = <span class="number">0</span>; num &lt; roomList.length; num++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((num + <span class="number">1</span>) % openedNum) === <span class="number">1</span> &amp;&amp; num !== <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// æ‰“å¼€å®šé‡çª—å£å æ–°å¼€ä¸€ä¸ªæµè§ˆå™¨</span></span><br><span class="line">                browser = <span class="keyword">await</span> puppeteer.launch(launchConfig);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">            handleRoomScreenShot(page, roomList[num], browser, (num &amp;&amp; ((num + <span class="number">1</span>) % openedNum === <span class="number">0</span>)), num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">await</span> homePage.goto(homeHost, &#123;</span><br><span class="line">        waitUntil: [<span class="string">'domcontentloaded'</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start();</span><br></pre></td></tr></table></figure>
<p>æŠ“å–åçš„æˆªå›¾ï¼ŒæŒ‰æˆ¿é—´å·åˆ†å¼€ä¿å­˜ï¼š<br><img src="/blog/2018/11/20/puppeteeræˆªå–ç›´æ’­é—´ç”»é¢/result.png" alt="result.png"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p> äº†è§£ <code>Puppeteer</code> çš„å‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œç›´æ¥åˆ°å¯¹åº”çš„åŠŸèƒ½æ¨¡å—å»æŸ¥æ‰¾æ¦‚å¿µå°±å¯ä»¥åšä¸€äº›ç®€å•çš„å°ç¨‹åºäº†ï¼Œä¾‹å¦‚çˆ¬è™«ï¼Œæˆªå›¾ï¼Œä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ç­‰ç­‰ï¼Œç”¨åˆ°ä»€ä¹ˆåŠŸèƒ½ <code>API</code> å°±å¥½å•¦ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ <code>Puppeteer</code> è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œå¦‚æœè¦ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒçš„éœ€è¦æ…é‡ä¸€äº›ã€‚<br> å¦å¤–ï¼Œæä¾›çš„demoç¨‹åºä¹Ÿä»…ä¾›å‚è€ƒï¼Œæœ‰å¾ˆå¤šå®¹é”™å’Œå¯ç”¨æ€§å¤„äºæ–¹ä¾¿éƒ½è€ƒè™‘çš„ä¸æ˜¯å¾ˆå¤šã€‚<br> æ€»çš„è€Œè¨€ï¼Œ <code>Puppeteer</code> å¯ä»¥å®ç°å¾ˆå¤šå¥½ç©çš„ä¸œè¥¿ï¼Œæœ‰ç©ºçš„è¯å¯ä»¥å¤šå¤šæ¢ç´¢å“¦ï¼</p>
</div><div class="tags"><a href="/blog/tags/å·¥å…·/">å·¥å…·</a></div><div class="post-nav"><a class="next" href="/blog/2018/08/11/å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º/">å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'jHUxpH4l71M0cttbwppTQmHw-gzGzoHsz',
  appKey:'nTJUGg5SKK6Q5QbQKjgLbDr3',
  placeholder:'å°½æƒ…åæ§½å§...em... æˆ‘åæ‚”äº†,å¤§ä¾ å˜´ä¸‹ç•™æƒ…',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://cheerylong.github.io/blog"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/å°ç¨‹åº/">å°ç¨‹åº</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/å·¥å…·/">å·¥å…·</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/æ„Ÿæ‚Ÿ/">æ„Ÿæ‚Ÿ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/æ•°æ®ç»“æ„å’Œç®—æ³•/">æ•°æ®ç»“æ„å’Œç®—æ³•</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/é›¶æ•£çŸ¥è¯†æ‹¾é—/">é›¶æ•£çŸ¥è¯†æ‹¾é—</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/blog/tags/JavaScriptæ•°æ®ç»“æ„/" style="font-size: 15px;">JavaScriptæ•°æ®ç»“æ„</a> <a href="/blog/tags/æ„Ÿæ‚Ÿ/" style="font-size: 15px;">æ„Ÿæ‚Ÿ</a> <a href="/blog/tags/å…¶å®ƒ/" style="font-size: 15px;">å…¶å®ƒ</a> <a href="/blog/tags/å°ç¨‹åº/" style="font-size: 15px;">å°ç¨‹åº</a> <a href="/blog/tags/ç”Ÿæ´»/" style="font-size: 15px;">ç”Ÿæ´»</a> <a href="/blog/tags/å·¥å…·/" style="font-size: 15px;">å·¥å…·</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/20/puppeteeræˆªå–ç›´æ’­é—´ç”»é¢/">Puppeteeræˆªå–ç›´æ’­ç”»é¢</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/11/å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º/">å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/11/å°ç¨‹åºä¹‹å·¥ç¨‹åŒ–/">å°ç¨‹åºä¹‹å·¥ç¨‹åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/06/å°ç¨‹åºä¹‹æ•°æ®ç»Ÿè®¡/">å°ç¨‹åºä¹‹æ•°æ®ç»Ÿè®¡</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/05/å°ç¨‹åºä¹‹ç™»å½•/">å°ç¨‹åºä¹‹ç™»å½•</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/17/æœ€è¿‘ç³Ÿå¿ƒçš„ä¸€ç‚¹äº‹/">æœ€è¿‘ç³Ÿå¿ƒçš„ä¸€ç‚¹äº‹</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/07/å›¾ç‰‡æ ¼å¼æ¯”è¾ƒ/">å›¾ç‰‡æ ¼å¼æ¯”è¾ƒ</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/01/JSæ•°æ®ç»“æ„ä¹‹é“¾è¡¨/">JSæ•°æ®ç»“æ„ä¹‹é“¾è¡¨</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/23/å…³äºå†™åšå®¢/">å…³äºå†™åšå®¢</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://github.com/cheerylong" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.zhihu.com/people/jie-wei-17-90/activities" title="çŸ¥ä¹" target="_blank">çŸ¥ä¹</a><ul></ul><a href="https://juejin.im/user/57c6aaa8c4c9710061a7fbe4" title="æ˜é‡‘" target="_blank">æ˜é‡‘</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2018 <a href="/blog/." rel="nofollow">cheerylong'blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=0.0.0"></script></div></body></html>