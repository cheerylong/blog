<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="å‰ç«¯"><title>axiosæºç æµ…æ | cheerylong'blog</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">axiosæºç æµ…æ</h1><a id="logo" href="/blog/.">cheerylong'blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/blog/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/blog/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">axiosæºç æµ…æ</h1><div class="post-meta">Jun 2, 2019<span> | </span><span class="category"><a href="/blog/categories/JavaScript/">JavaScript</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span></div><a class="disqus-comment-count" href="/blog/2019/06/02/axiosæºç æµ…æ/#vcomment"><span class="valine-comment-count" data-xid="/blog/2019/06/02/axiosæºç æµ…æ/"></span><span> æ¡è¯„è®º</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Axiosç®€ä»‹"><span class="toc-number">1.</span> <span class="toc-text">Axiosç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æºç ç›®å½•ä»‹ç»"><span class="toc-number">2.</span> <span class="toc-text">æºç ç›®å½•ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æºç æ¶æ„"><span class="toc-number">3.</span> <span class="toc-text">æºç æ¶æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ğŸ¤”-å¦‚ä½•å®ç°-axios-æ‰€æ”¯æŒçš„çš„åŠŸèƒ½"><span class="toc-number">4.</span> <span class="toc-text">ğŸ¤” å¦‚ä½•å®ç° axios æ‰€æ”¯æŒçš„çš„åŠŸèƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ”¯æŒ-Node-å’Œ-æµè§ˆå™¨-ç«¯çš„-http-è¯·æ±‚"><span class="toc-number">4.1.</span> <span class="toc-text">æ”¯æŒ Node å’Œ æµè§ˆå™¨ ç«¯çš„ http è¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è¯·æ±‚å“åº”æ‹¦æˆªå™¨"><span class="toc-number">4.2.</span> <span class="toc-text">è¯·æ±‚å“åº”æ‹¦æˆªå™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®"><span class="toc-number">4.3.</span> <span class="toc-text">è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å–æ¶ˆè¯·æ±‚"><span class="toc-number">4.4.</span> <span class="toc-text">å–æ¶ˆè¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ-XSRF"><span class="toc-number">4.5.</span> <span class="toc-text">å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ XSRF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®Œæ•´æµç¨‹"><span class="toc-number">5.</span> <span class="toc-text">å®Œæ•´æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¦‚ä½•å¼€å‘ä¸€ä¸ª-Axios-è¿™æ ·çš„å¼€æºå·¥å…·åº“"><span class="toc-number">6.</span> <span class="toc-text">å¦‚ä½•å¼€å‘ä¸€ä¸ª Axios è¿™æ ·çš„å¼€æºå·¥å…·åº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»“è¯­"><span class="toc-number">7.</span> <span class="toc-text">ç»“è¯­</span></a></li></ol></div></div><div class="post-content"><h2 id="Axiosç®€ä»‹"><a href="#Axiosç®€ä»‹" class="headerlink" title="Axiosç®€ä»‹"></a>Axiosç®€ä»‹</h2><p>  åŸºäºPromiseçš„HTTPå®¢æˆ·ç«¯ï¼Œç”¨äºæµè§ˆå™¨å’Œnode.js</p>
<ul>
<li>æ”¯æŒæµè§ˆå™¨ç«¯ <code>ajax</code> è¯·æ±‚</li>
<li>æ”¯æŒä» <code>node.js</code> å‘å‡ºhttpè¯·æ±‚</li>
<li>æ”¯æŒ <code>Promise API</code></li>
<li>æ”¯æŒæ‹¦æˆªè¯·æ±‚å’Œå“åº”</li>
<li>è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®</li>
<li>å–æ¶ˆè¯·æ±‚</li>
<li>è‡ªåŠ¨è½¬æ¢JSONæ•°æ®</li>
<li>å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒXSRF</li>
</ul>
<h2 id="æºç ç›®å½•ä»‹ç»"><a href="#æºç ç›®å½•ä»‹ç»" class="headerlink" title="æºç ç›®å½•ä»‹ç»"></a>æºç ç›®å½•ä»‹ç»</h2><p><img src="/blog/2019/06/02/axiosæºç æµ…æ/dir.png" alt=""></p>
<h2 id="æºç æ¶æ„"><a href="#æºç æ¶æ„" class="headerlink" title="æºç æ¶æ„"></a>æºç æ¶æ„</h2><ul>
<li>åˆ›å»ºä¸€ä¸ª <code>Axios</code> æ„é€ å‡½æ•°ï¼Œæ·»åŠ é»˜è®¤é…ç½®ï¼Œæ‹¦æˆªå™¨ï¼ŒåŸå‹ä¸ŠæŒ‚è½½è¯·æ±‚æ–¹æ³•</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// core/axios.js</span></span><br><span class="line"><span class="comment">// æ„é€ Axiosæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Axios</span>(<span class="params">instanceConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.defaults = instanceConfig;</span><br><span class="line">  <span class="comment">// æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">  <span class="keyword">this</span>.interceptors = &#123;</span><br><span class="line">    request: <span class="keyword">new</span> InterceptorManager(),</span><br><span class="line">    response: <span class="keyword">new</span> InterceptorManager()</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®é™…è¯·æ±‚æ–¹æ³•</span></span><br><span class="line">Axios.prototype.request = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">Axios.prototype.getUri = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ²¡æœ‰è¯·æ±‚ä½“ delete get head options</span></span><br><span class="line">Axios.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">url, config = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.request(<span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">    method: <span class="string">'get'</span>,</span><br><span class="line">    url</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰è¯·æ±‚ä½“ post put patch</span></span><br><span class="line">Axios.prototype.post = <span class="function"><span class="keyword">function</span>(<span class="params">url, data, config = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.request(<span class="built_in">Object</span>.assign(config, &#123;</span><br><span class="line">    method: <span class="string">'post'</span>,</span><br><span class="line">    url,</span><br><span class="line">    data</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>å®ä¾‹åŒ–ä¸€ä¸ª<code>Axios</code>å®ä¾‹<code>context</code>ï¼Œæ¥ç€åˆ›å»º<code>instance</code>æŒ‡å‘<code>Axios.prototype.request</code>æ–¹æ³•ï¼Œå¹¶ç»‘å®šäº†ä¸Šä¸‹æ–‡<code>context</code>ï¼›</li>
<li>é€šè¿‡<code>extend</code>æ–¹æ³•æŠŠ<code>context</code>ä¸­çš„åŸå‹æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•å…¨éƒ¨æ‹·è´åˆ°<code>instance</code>ä¸Š ï¼Œè¿”å›<code>instance</code></li>
<li>åˆ›å»ºä¸€ä¸ªé»˜è®¤å®ä¾‹ï¼ŒæŒ‚è½½å¿«æ·æ–¹æ³•<code>create</code>,<code>CancelToken</code>,<code>all</code>ç­‰æ–¹æ³•</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// axios.js</span></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªAxioså®ä¾‹ï¼ŒæŒ‚è½½è¾…åŠ©æ–¹æ³•ï¼Œå¹¶å¯¼å‡ºè¯¥æ··åˆå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createInstance</span>(<span class="params">defaultConfig = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> context = <span class="keyword">new</span> Axios(defaultConfig);</span><br><span class="line">  <span class="keyword">var</span> instance = bind(Axios.prototype.request, context);</span><br><span class="line">  <span class="comment">// Copy axios.prototype to instance</span></span><br><span class="line">  utils.extend(instance, Axios.prototype, context)</span><br><span class="line">  <span class="comment">// copy context to instance</span></span><br><span class="line">  utils.extend(instance, context)</span><br><span class="line">  <span class="keyword">return</span> intance</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// create the default instance to be exported</span></span><br><span class="line"><span class="keyword">var</span> axios = createInstance(&#123;&#125;)</span><br><span class="line">axios.Axios = Axios</span><br><span class="line">axios.create= <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createInstance(<span class="built_in">Object</span>.assign(axios.defaults, config))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å–æ¶ˆè¯·æ±‚</span></span><br><span class="line">axios.Cancel = <span class="built_in">require</span>(<span class="string">'./cancel/Cancel'</span>)</span><br><span class="line">axios.CancelToken = <span class="built_in">require</span>(<span class="string">'./cancel/CancelToken'</span>)</span><br><span class="line">axios.isCancel = <span class="built_in">require</span>(<span class="string">'./cancel/isCancel'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prmoise.all çš„è¯­æ³•ç³–</span></span><br><span class="line">axios.all = <span class="built_in">Promise</span>.all</span><br><span class="line">axios.spread = <span class="built_in">require</span>(<span class="string">'./helpers/spread'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="ğŸ¤”-å¦‚ä½•å®ç°-axios-æ‰€æ”¯æŒçš„çš„åŠŸèƒ½"><a href="#ğŸ¤”-å¦‚ä½•å®ç°-axios-æ‰€æ”¯æŒçš„çš„åŠŸèƒ½" class="headerlink" title="ğŸ¤” å¦‚ä½•å®ç° axios æ‰€æ”¯æŒçš„çš„åŠŸèƒ½"></a>ğŸ¤” å¦‚ä½•å®ç° <code>axios</code> æ‰€æ”¯æŒçš„çš„åŠŸèƒ½</h2><h3 id="æ”¯æŒ-Node-å’Œ-æµè§ˆå™¨-ç«¯çš„-http-è¯·æ±‚"><a href="#æ”¯æŒ-Node-å’Œ-æµè§ˆå™¨-ç«¯çš„-http-è¯·æ±‚" class="headerlink" title="æ”¯æŒ Node å’Œ æµè§ˆå™¨ ç«¯çš„ http è¯·æ±‚"></a>æ”¯æŒ <code>Node</code> å’Œ <code>æµè§ˆå™¨</code> ç«¯çš„ <code>http</code> è¯·æ±‚</h3><ul>
<li><p>å…³é”®ä»£ç </p>
<ul>
<li><a href="https://github.com/axios/axios/tree/master/lib/adapters" target="_blank" rel="noopener">lib/adpters</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/defaults.js" target="_blank" rel="noopener">lib/defaults.js</a></li>
</ul>
</li>
<li><p>åŸç†ä»‹ç»</p>
<ul>
<li>é€šè¿‡ <code>process</code> åŒºåˆ†å‡º <code>Node</code> ç¯å¢ƒå’Œæµè§ˆå™¨ç¯å¢ƒ</li>
<li>æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨ <code>XMLHttpRquest</code> å‘èµ·httpè¯·æ±‚ï¼ŒNodeç¯å¢ƒä½¿ç”¨<code>http</code>ï¼Œ<code>https</code> æ¨¡å—å‘èµ·è¯·æ±‚</li>
<li>é€šè¿‡ <code>Promise</code> åŒ…è£…å®ç°è¯·æ±‚æ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="è¯·æ±‚å“åº”æ‹¦æˆªå™¨"><a href="#è¯·æ±‚å“åº”æ‹¦æˆªå™¨" class="headerlink" title="è¯·æ±‚å“åº”æ‹¦æˆªå™¨"></a>è¯·æ±‚å“åº”æ‹¦æˆªå™¨</h3><ul>
<li><p>å…³é”®ä»£ç </p>
<ul>
<li>lib/core/InterceptorManager.js </li>
<li>lib/core/Axio.js</li>
</ul>
</li>
<li><p>æ‹¦æˆªå™¨è¿è¡Œç¤ºæ„</p>
</li>
</ul>
<p><img src="/blog/2019/06/02/axiosæºç æµ…æ/interceptor.png" style="margin-left: 200px;"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span></span><br><span class="line">.then(request[<span class="number">1</span>].fulfilled, request[<span class="number">1</span>].rejected)</span><br><span class="line">.then(request[<span class="number">0</span>].fulfilled, request[<span class="number">1</span>].rejected)</span><br><span class="line">.then(dispatchRequest, <span class="literal">undefined</span>)</span><br><span class="line">.then(request[<span class="number">0</span>].fulfilled, request[<span class="number">0</span>].rejected)</span><br><span class="line">.then(request[<span class="number">1</span>].fulfilled, request[<span class="number">1</span>].rejected)</span><br><span class="line">.then() <span class="comment">// user opt</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åŸç†ä»‹ç»<ul>
<li>å®ç°ä¸€ä¸ªæ‹¦æˆªå™¨ç±»ä¸­ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œæ·»åŠ æ‹¦æˆªå™¨æ–¹æ³• <code>use</code> , ç§»é™¤æ‹¦æˆªå™¨æ–¹æ³• <code>eject</code>,<br>éå†æ‹¦æˆªå™¨æ–¹æ³• <code>forEach</code></li>
<li>åˆ©ç”¨æ•°ç»„ <code>unshift</code>, <code>push</code> æ–¹æ³•ï¼Œæ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨å’Œå“åº”æ‹¦æˆªå™¨</li>
<li>åˆ©ç”¨ <code>Promise.then</code> é“¾å¼è°ƒç”¨æ·»åŠ çš„æ‹¦æˆªå™¨</li>
</ul>
</li>
</ul>
<p>å¦‚æœå¤§å®¶æœ‰äº†è§£è¿‡<code>Koa</code>çš„ä¸­é—´ä»¶åŸç†ï¼Œå¯èƒ½ä¼šå‘ç°å¾ˆç›¸ä¼¼</p>
<p><img src="/blog/2019/06/02/axiosæºç æµ…æ/YCUN.PNG" style="margin-left: 200px;"></p>
<h3 id="è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®"><a href="#è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®" class="headerlink" title="è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®"></a>è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®</h3><ul>
<li><p>å…³é”®ä»£ç </p>
<ul>
<li><a href="https://github.com/axios/axios/blob/master/lib/core/transformData.js" target="_blank" rel="noopener">lib/core/transformData.js</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/defaults.js" target="_blank" rel="noopener">lib/default.js</a></li>
</ul>
</li>
<li><p>åŸç†ä»‹ç»</p>
<ul>
<li>é»˜è®¤é…ç½®ä¸­å†…ç½®é»˜è®¤ <code>transformRequest</code>, <code>transformResponse</code> æ–¹æ³•ï¼Œå¤„ç†å¸¸è§æƒ…å†µ</li>
<li><p>ç¼–å†™<code>transformData</code> æ–¹æ³•ï¼Œéå†å¤šä¸ªè½¬æ¢å™¨ï¼Œå¤„ç†æ•°æ®</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transformData</span>(<span class="params">data, headers, fns</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*eslint no-param-reassign:0*/</span></span><br><span class="line">  utils.forEach(fns, <span class="function"><span class="keyword">function</span> <span class="title">transform</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    data = fn(data, headers);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>dispatchRequest</code> è¯·æ±‚å‰ï¼Œè°ƒç”¨ <code>transformData</code> è°ƒç”¨æ‰€æœ‰çš„è¯·æ±‚è½¬åŒ–å™¨å¤„ç†è¯·æ±‚æ•°æ®</p>
</li>
<li>è¯·æ±‚å®Œæˆåï¼Œè°ƒç”¨ <code>transformData</code> è°ƒç”¨æ‰€æœ‰çš„å“åº”è½¬åŒ–å™¨å¤„ç†å“åº”æ•°æ®</li>
</ul>
</li>
</ul>
<h3 id="å–æ¶ˆè¯·æ±‚"><a href="#å–æ¶ˆè¯·æ±‚" class="headerlink" title="å–æ¶ˆè¯·æ±‚"></a>å–æ¶ˆè¯·æ±‚</h3><ul>
<li><p>å…³é”®ä»£ç </p>
<ul>
<li><a href="https://github.com/axios/axios/blob/master/lib/cancel/CancelToken.js" target="_blank" rel="noopener">lib/cancel/CancelToken.js</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/adapters/xhr.js" target="_blank" rel="noopener">lib/adpters/xhr.js</a></li>
</ul>
</li>
<li><p>åŸç†ä»‹ç»</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª <code>CancelToken</code> æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª <code>executor</code> å‡½æ•°ï¼Œå†…éƒ¨å®ä¾‹åŒ–ä¸€ä¸ª <code>pending</code> çŠ¶æ€çš„ <code>Promise</code> å¯¹è±¡ï¼Œç„¶åç”¨ä¸€ä¸ª <code>resolvePromise</code> å˜é‡æŒ‡å‘ <code>resolve</code> å‡½æ•°ã€‚</li>
<li>æ¥ç€æ‰§è¡Œ executor å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ª <code>cancel</code> å‡½æ•°ï¼Œåœ¨ <code>cancel</code> å‡½æ•°å†…éƒ¨ï¼Œä¼šè°ƒç”¨ <code>resolvePromise</code> æŠŠ <code>Promise</code> å¯¹è±¡ä» <code>pending</code> çŠ¶æ€å˜ä¸º <code>resolved</code> çŠ¶æ€ã€‚</li>
<li>åœ¨ <code>request</code> è¯·æ±‚ä¸­çš„ <code>resolvePromise.then</code> è¢«æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<h3 id="å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ-XSRF"><a href="#å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ-XSRF" class="headerlink" title="å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ XSRF"></a>å®¢æˆ·ç«¯æ”¯æŒé˜²èŒƒ <code>XSRF</code></h3><ul>
<li><p>XSRFä»‹ç»</p>
<p><img src="/blog/2019/06/02/axiosæºç æµ…æ/csrf.jpg"></p>
</li>
<li><p>é˜²èŒƒæ–¹æ³•</p>
<ul>
<li>éªŒè¯è¯·æ±‚ <code>referer</code>, ä½†ç”±äº <code>referer</code> ä¹Ÿå¯ä»¥ä¸ºé€ ï¼Œä½œç”¨æœ‰é™</li>
<li>æœåŠ¡å™¨ç«¯ç”Ÿæˆ <code>token</code>ï¼Œå¹¶é€šè¿‡ <code>set-cookie</code> çš„æ–¹å¼ç§åˆ°å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä» <code>cookie</code> ä¸­å¯¹åº”çš„å­—æ®µè¯»å–å‡º <code>token</code>ï¼Œç„¶åæ·»åŠ åˆ°è¯·æ±‚ <code>headers</code> ä¸­ã€‚ç”±äºè¿™ä¸ª <code>token</code> æ¯”è¾ƒéš¾ä¼ªé€ ï¼Œæ‰€ä»¥å°±èƒ½åŒºåˆ†è¿™ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯ç”¨æˆ·æ­£å¸¸å‘èµ·çš„ã€‚</li>
</ul>
</li>
<li><p>å…³é”®ä»£ç </p>
<ul>
<li><a href="https://github.com/axios/axios/blob/master/lib/helpers/isURLSameOrigin.js" target="_blank" rel="noopener">lib/helpers/isURLSameOrigin.js</a></li>
<li><a href="https://github.com/axios/axios/blob/master/lib/adapters/xhr.js" target="_blank" rel="noopener">lib/adpters/xhr.js</a></li>
</ul>
</li>
<li><p>åŸç†ä»‹ç»</p>
<ul>
<li>é¦–å…ˆåˆ¤æ–­å¦‚æœæ˜¯é…ç½® <code>withCredentials</code> ä¸º <code>true</code> æˆ–è€…æ˜¯åŒåŸŸè¯·æ±‚ï¼Œæˆ‘ä»¬æ‰ä¼šè¯·æ±‚ <code>headers</code> æ·»åŠ  <code>xsrf</code> ç›¸å…³çš„å­—æ®µã€‚</li>
<li>å¦‚æœåˆ¤æ–­æˆåŠŸï¼Œå°è¯•ä» <code>cookie</code> ä¸­è¯»å– <code>xsrf</code> çš„ <code>token</code> å€¼ã€‚</li>
<li>å¦‚æœèƒ½è¯»åˆ°ï¼Œåˆ™æŠŠå®ƒæ·»åŠ åˆ°è¯·æ±‚ <code>headers</code> çš„ <code>xsrf</code> ç›¸å…³å­—æ®µä¸­ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å®Œæ•´æµç¨‹"><a href="#å®Œæ•´æµç¨‹" class="headerlink" title="å®Œæ•´æµç¨‹"></a>å®Œæ•´æµç¨‹</h2><p><img src="/blog/2019/06/02/axiosæºç æµ…æ/axios.jpg" alt=""></p>
<h2 id="å¦‚ä½•å¼€å‘ä¸€ä¸ª-Axios-è¿™æ ·çš„å¼€æºå·¥å…·åº“"><a href="#å¦‚ä½•å¼€å‘ä¸€ä¸ª-Axios-è¿™æ ·çš„å¼€æºå·¥å…·åº“" class="headerlink" title="å¦‚ä½•å¼€å‘ä¸€ä¸ª Axios è¿™æ ·çš„å¼€æºå·¥å…·åº“"></a>å¦‚ä½•å¼€å‘ä¸€ä¸ª <code>Axios</code> è¿™æ ·çš„å¼€æºå·¥å…·åº“</h2><ul>
<li>éœ€æ±‚åˆ†æï¼Œä¾‹å¦‚ <code>Axios</code> æ”¯æŒçš„ <code>feature</code>ï¼Œå°±æ˜¯éœ€æ±‚åˆ†æ</li>
<li>é¡¹ç›®æ­å»ºï¼Œå®Œæ•´çš„æ„å»ºå‘å¸ƒæµç¨‹å’Œå®Œå¤‡æµ‹è¯•caseå¯ä»¥å¢åŠ å¼€å‘æ•ˆç‡å’Œä¿¡ä»»åº¦ï¼Œ <code>Axios</code> é‡‡ç”¨ <code>grunt</code> æ„å»º (ç°åœ¨æ›´å¤šä¼šé€‰æ‹© <code>webpack</code>, <code>rollup</code>, <code>parcel</code> ç­‰)ï¼Œå¹¶å…·æœ‰å®Œå¤‡çš„æµ‹è¯•ï¼Œç¤ºä¾‹ä»£ç ã€‚</li>
<li>API è®¾è®¡ï¼Œç¡®å®šéœ€æ±‚ä¹‹åï¼Œä¸€å®šè¦èŠ±æ—¶é—´è®¾è®¡å‹å¥½ï¼Œæ˜“ç”¨çš„APIï¼Œ <code>Axios</code> å°±æœ‰å¤šç§å¤šæ ·çš„ä½¿ç”¨æ–¹å¼ï¼Œè¶³å¤Ÿçµæ´»ã€‚</li>
<li>å®é™…ç¼–ç ï¼Œè¿™éƒ¨åˆ†å¯èƒ½æ˜¯èŠ±æ—¶é—´æœ€å°‘çš„å“¦ğŸ˜¯~</li>
<li>å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹å’Œç¤ºä¾‹ï¼Œ<code>Axios</code> çš„æµ‹è¯•caseéå¸¸ä¹‹å¤šï¼Œ<code>example</code> ä¸‹çš„ç¤ºä¾‹ä»£ç ä¹Ÿå¾ˆä¸°å¯Œ</li>
<li>è¯¦ç»†çš„æ–‡æ¡£ï¼Œåˆ—å‡ºä½¿ç”¨çš„æ–¹æ³•ï¼Œå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œ</li>
<li>issue æ¨¡æ¿ï¼Œæ–¹ä¾¿ç”¨æˆ·åé¦ˆä½¿ç”¨ä¸­çš„é—®é¢˜</li>
</ul>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>  é˜…è¯»ç¤¾åŒºä¼˜ç§€çš„æºç ï¼Œæœ‰åŠ©äºå¼€æ‹“è§†é‡ï¼Œåšåˆ°çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œé‡åˆ°é—®é¢˜æ‰èƒ½è½»æ¾è§£å†³~</p>
<ul>
<li>è½¬è½½è¯·æ³¨æ˜<a href="http://cheerylong.site/blog/2019/06/02/axiosæºç æµ…æ/" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></li>
</ul>
</div><div class="tags"><a href="/blog/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a class="next" href="/blog/2019/01/24/Nativeå¦‚ä½•æ„å»ºå¸ƒå±€ï¼ˆä»¥åŠFabricå°†åšå‡ºçš„æ”¹å˜ï¼‰/">ã€è¯‘ã€‘React Nativeå¸ƒå±€åŸç†ï¼ˆä»¥åŠFabricå°†åšå‡ºçš„æ”¹å˜ï¼‰</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'jHUxpH4l71M0cttbwppTQmHw-gzGzoHsz',
  appKey:'nTJUGg5SKK6Q5QbQKjgLbDr3',
  placeholder:'å°½æƒ…åæ§½å§...em... æˆ‘åæ‚”äº†,å¤§ä¾ å˜´ä¸‹ç•™æƒ…',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://cheerylong.github.io/blog"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/JavaScript/">JavaScript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/React-Native/">React Native</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/å°ç¨‹åº/">å°ç¨‹åº</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/å·¥å…·/">å·¥å…·</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/æ„Ÿæ‚Ÿ/">æ„Ÿæ‚Ÿ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/æ•°æ®ç»“æ„å’Œç®—æ³•/">æ•°æ®ç»“æ„å’Œç®—æ³•</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/ç”Ÿæ´»/">ç”Ÿæ´»</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/é›¶æ•£çŸ¥è¯†æ‹¾é—/">é›¶æ•£çŸ¥è¯†æ‹¾é—</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/blog/tags/JavaScriptæ•°æ®ç»“æ„/" style="font-size: 15px;">JavaScriptæ•°æ®ç»“æ„</a> <a href="/blog/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/blog/tags/React-Native/" style="font-size: 15px;">React Native</a> <a href="/blog/tags/å·¥å…·/" style="font-size: 15px;">å·¥å…·</a> <a href="/blog/tags/æ„Ÿæ‚Ÿ/" style="font-size: 15px;">æ„Ÿæ‚Ÿ</a> <a href="/blog/tags/å…¶å®ƒ/" style="font-size: 15px;">å…¶å®ƒ</a> <a href="/blog/tags/å°ç¨‹åº/" style="font-size: 15px;">å°ç¨‹åº</a> <a href="/blog/tags/ç”Ÿæ´»/" style="font-size: 15px;">ç”Ÿæ´»</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2019/06/02/axiosæºç æµ…æ/">axiosæºç æµ…æ</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/24/Nativeå¦‚ä½•æ„å»ºå¸ƒå±€ï¼ˆä»¥åŠFabricå°†åšå‡ºçš„æ”¹å˜ï¼‰/">ã€è¯‘ã€‘React Nativeå¸ƒå±€åŸç†ï¼ˆä»¥åŠFabricå°†åšå‡ºçš„æ”¹å˜ï¼‰</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/20/puppeteeræˆªå–ç›´æ’­é—´ç”»é¢/">Puppeteeræˆªå–ç›´æ’­ç”»é¢</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/11/å°ç¨‹åºä¹‹å·¥ç¨‹åŒ–/">å°ç¨‹åºä¹‹å·¥ç¨‹åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/11/å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º/">å°ç¨‹åºä¹‹å›¾ç‰‡å¯¼å‡º</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/06/å°ç¨‹åºä¹‹æ•°æ®ç»Ÿè®¡/">å°ç¨‹åºä¹‹æ•°æ®ç»Ÿè®¡</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/05/å°ç¨‹åºä¹‹ç™»å½•/">å°ç¨‹åºä¹‹ç™»å½•</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/17/æœ€è¿‘ç³Ÿå¿ƒçš„ä¸€ç‚¹äº‹/">æœ€è¿‘ç³Ÿå¿ƒçš„ä¸€ç‚¹äº‹</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/07/å›¾ç‰‡æ ¼å¼æ¯”è¾ƒ/">å›¾ç‰‡æ ¼å¼æ¯”è¾ƒ</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/29/JavaScriptå®ç°sleep/">jså®ç°sleep</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://github.com/cheerylong" title="Github" target="_blank">Github</a><ul></ul><a href="https://www.zhihu.com/people/jie-wei-17-90/activities" title="çŸ¥ä¹" target="_blank">çŸ¥ä¹</a><ul></ul><a href="https://juejin.im/user/57c6aaa8c4c9710061a7fbe4" title="æ˜é‡‘" target="_blank">æ˜é‡‘</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2019 <a href="/blog/." rel="nofollow">cheerylong'blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = '//hm.baidu.com/hm.js?' + 'fbd56cca57242535d5a2abe135b52021';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=0.0.0"></script></div></body></html>