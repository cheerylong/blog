---
title: 小程序之数据统计
date: 2018-08-06 23:39:41
tags: 小程序
categories: 小程序
toc: true
---

数据统计作为目前一种常用的分析用户行为的方式，小程序端也是必不可少的。小程序采取的曝光，点击数据埋点其实和h5原理是一样的。但是埋点作为一个和业务逻辑不相关的需求，我们如果在每一个点击事件，每一个生命周期加入各种埋点代码，则会干扰正常的业务逻辑，和使代码变的臃肿，笔者提供以下几种思路来解决数据埋点：

## 埋点sdk

- 设计一个埋点sdk，借助该sdk实现无痕埋点，即做相应的配置即可实现埋点。思路如下：
    
    - 小程序的代码结构是，每一个 Page 中都有一个 Page 方法，接受一个包含生命周期函数，数据的 **业务逻辑对象** 包装这层数据，借助小程序的底层逻辑实现页面的业务逻辑，通过这个我们可以实现：
      - 我们对Page进行一次包装，篡改它的生命周期和点击事件，简单的代码如下：
      - 这种方式不光适用于埋点，也可以用来作全局异常处理，请求的统一处理等场景。

```js
  
  代码仅供理解思路
  page = function(params) {
    let keys = params.keys()
    keys.forEach(v => {
        if (v === 'onLoad') {
          params[v] = function(options) {
            stat()   //曝光埋点代码
            params[v].call(this, options)
          }
        }
        else if (v.includes('click')) {
          params[v] = funciton(event) { 
            let data = event.dataset.config
            stat(data)  // 点击埋点
            param[v].call(this)
          }
        }
    })
  }
```


## 接口埋点

- 对于特殊的一些业务，我们可以采取 **接口埋点**，什么叫接口埋点呢？很多情况下，我们有的api并不是多处调用的，只会在某一个特定的页面调用，通过这个思路我们可以分析出，该接口被请求，则这个行为被触发了，则完全可以通过服务端日志得出埋点数据，但是这种方式局限性较大，而且属于分析结果得出过程，可能存在误差，但可以作为一种思路了解一下。



## 微信提供的能力

- 微信本身提供的数据分析能力，微信本身提供了常规分析和自定义分析两种数据分析方式，在小程序后台配置即可。借助**小程序数据助手**可以很方便的查看。










































